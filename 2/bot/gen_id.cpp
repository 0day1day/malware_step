#include "gen_id.h"
#include "adler32.h"

DWORD GetBotId()
{
	HKEY hKey;
	DWORD res =	RegOpenKeyEx(HKEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Cryptography", NULL, KEY_READ | KEY_WOW64_64KEY, &hKey);
	if (res == ERROR_SUCCESS)
	{
		DWORD dataType = REG_SZ;
		char buffer[512];
		DWORD size = sizeof(buffer);
		res = RegQueryValueEx(hKey, "MachineGuid", NULL, &dataType, (LPBYTE)&buffer, &size);
		if (res == ERROR_SUCCESS)
		{
			DWORD id = adler32((byte*)buffer, size);
			return id;
		}
	}
	return false;
}
